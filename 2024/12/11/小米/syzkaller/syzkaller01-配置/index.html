<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>syzkaller01-配置 | qjl988</title><meta name="author" content="qjl988"><meta name="copyright" content="qjl988"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一、Syzkaller工作原理  1.1 简介 syzkaller是一个无监督的用覆盖率做引导的内核模糊测试工具，以系统调用为基础进行设计。由google安全人员研发并一直改进更新。syzkaller系统的结构如下图所示，其中绿色部分运行在host上，黄色部分运行在VM或android机器上 syz-manager负责启动、监控、重启VM实例，并在VM中启动syz-fuzzer进程。syz-ma">
<meta property="og:type" content="article">
<meta property="og:title" content="syzkaller01-配置">
<meta property="og:url" content="https://qjl988.github.io/2024/12/11/%E5%B0%8F%E7%B1%B3/syzkaller/syzkaller01-%E9%85%8D%E7%BD%AE/index.html">
<meta property="og:site_name" content="qjl988">
<meta property="og:description" content="一、Syzkaller工作原理  1.1 简介 syzkaller是一个无监督的用覆盖率做引导的内核模糊测试工具，以系统调用为基础进行设计。由google安全人员研发并一直改进更新。syzkaller系统的结构如下图所示，其中绿色部分运行在host上，黄色部分运行在VM或android机器上 syz-manager负责启动、监控、重启VM实例，并在VM中启动syz-fuzzer进程。syz-ma">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://qjl988.github.io/img/butterfly-icon.png">
<meta property="article:published_time" content="2024-12-10T17:10:45.000Z">
<meta property="article:modified_time" content="2024-12-10T17:21:48.774Z">
<meta property="article:author" content="qjl988">
<meta property="article:tag" content="fuzz">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://qjl988.github.io/img/butterfly-icon.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://qjl988.github.io/2024/12/11/%E5%B0%8F%E7%B1%B3/syzkaller/syzkaller01-%E9%85%8D%E7%BD%AE/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'syzkaller01-配置',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/loading.gif" data-original="/img/butterfly-icon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">3</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">qjl988</span></a><a class="nav-page-title" href="/"><span class="site-name">syzkaller01-配置</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">syzkaller01-配置</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-12-10T17:10:45.000Z" title="发表于 2024-12-11 01:10:45">2024-12-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-12-10T17:21:48.774Z" title="更新于 2024-12-11 01:21:48">2024-12-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">3.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>13分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="一-syzkaller工作原理"><a class="markdownIt-Anchor" href="#一-syzkaller工作原理"></a> 一、Syzkaller工作原理</h1>
<h2 id="11-简介"><a class="markdownIt-Anchor" href="#11-简介"></a> 1.1 简介</h2>
<p>syzkaller是一个无监督的用覆盖率做引导的内核模糊测试工具，以<strong>系统调用</strong>为基础进行设计。由google安全人员研发并一直改进更新。syzkaller系统的结构如下图所示，其中绿色部分运行在host上，黄色部分运行在VM或android机器上</p>
<p>syz-manager负责启动、监控、重启VM实例，并在VM中启动syz-fuzzer进程。syz-manager负责持久化存储负责语料库和crash记录。syz-manager运行在基于稳定kernel的host上。</p>
<p>syz-fuzzer进程运行在kernel不稳定的VM上。syz-fuzzer负责引导整个fuzzing过程（包括生成输入、修改输入、最小化程序等操作）并通过RPC将触发新覆盖度信息的输入发送给syz-manager。syz-fuzzer同时也负责启动syz-executor</p>
<p>每个syz-executor负责处理一个输入（一个输入包括一个syscalls序列），接受并执行从syz-fuzzer获取的程序并将执行结果返回给syz-fuzzer</p>
<p>syzkaller 有很多个部件，其中：</p>
<ul>
<li>syz-extract：用于解析 syzlang 中的常量</li>
<li>syz-sysgen：用于解析 syzlang，提取其中描述的 syscall 和参数类型，以及参数依赖关系</li>
<li>syz-manager：用于启动与管理 syzkaller</li>
<li>syz-fuzzer：实际在 VM 中运行的 fuzzer</li>
<li>syz-executor：实际在 VM 中运行的测试程序</li>
</ul>
<p>通过kcov收集覆盖率信息，若产生<strong>新的覆盖</strong>，则认为当前的case为<strong>有效</strong>case，此时syzkaller对case参数进行变异寻找系统漏洞。</p>
<h2 id="12-syscall-描述语言syzlang"><a class="markdownIt-Anchor" href="#12-syscall-描述语言syzlang"></a> 1.2. syscall 描述语言（syzlang）</h2>
<p>syzkaller使用它自己的声明式语言来描述系统调用模板，docs目录下的syscall_descriptions.md中可以找到相关的说明。这些系统调用模板被翻译成syzkaller使用的代码需要经过两个步骤。第一步是使用<strong>syz-extract</strong>从linux源代码中提取符号常量的值，结果被存储在.const文件中，例如/sys/linux/tty.txt被转换为sys/linux/tty_amd64.const。第二步是根据系统调用模板和第一步中生成的const文件使用<strong>syz-sysgen</strong>生成syzkaller用的go代码。可以在/sys/linux/gen/amd64.go和/executor/syscalls.h中看到结果。最后，重新编译生成带有相应规则的syzkaller二进制可执行文件。</p>
<p>syzkaller/sys/linux目录下的sys.txt中有通用的调用形式可以参考</p>
<p>syzlang语法见<a target="_blank" rel="noopener" href="https://github.com/google/syzkaller/blob/master/docs/syscall_descriptions_syntax.md">https://github.com/google/syzkaller/blob/master/docs/syscall_descriptions_syntax.md</a></p>
<h2 id="13-crash"><a class="markdownIt-Anchor" href="#13-crash"></a> 1.3. crash</h2>
<p>当发生crash时，syzkaller会将crash信息保存在<code>$workdir/crashes</code>中，一种crash类型会对应一个子文件夹，并保存相应的report、log文件</p>
<p><img src="/img/loading.gif" data-original="http://qjl988-tuchuang.oss-cn-beijing.aliyuncs.com/img/1280X1280.PNG" alt="1280X1280" /></p>
<p>一旦syzkaller在某个VM中检测到kernel crash，它将自动启动重现此crash的进程（除非你在配置中指定了&quot;reproduce&quot;: false）。默认情况下，它将使用4个虚拟机来复现crash，然后最小化导致crash的程序。可能会停止模糊测试，因为所有的VM可能都忙于复现检测到的崩溃。</p>
<p>复现一个崩溃的过程可能需要几分钟到一个小时不等，这取决于崩溃是否内核本身是一个比较封闭的系统，因此不太可能由fuzz工具自己探测到问题，不过内核自己可以在运行的同时检查自己是否有问题出现容易复现或根本无法复现。由于这个过程并不完美，有一种方法可以尝试手动重现崩溃，见<a target="_blank" rel="noopener" href="https://github.com/google/syzkaller/blob/master/docs/reproducing_crashes.md">https://github.com/google/syzkaller/blob/master/docs/reproducing_crashes.md</a></p>
<p>如果成功复现，它可以生成为两种形式之一：syzkaller程序或C程序。Syzkaller总是尝试生成更用户友好的C重程序，但有时因各种原因失败。如果syzkaller仅生成了一个syzkaller程序，有一种方法可以执行它们以手动复现和调试crash，见<a target="_blank" rel="noopener" href="https://github.com/google/syzkaller/blob/master/docs/reproducing_crashes.md">https://github.com/google/syzkaller/blob/master/docs/reproducing_crashes.md</a></p>
<h1 id="二-在syzkaller中添加规则自定义测试用例"><a class="markdownIt-Anchor" href="#二-在syzkaller中添加规则自定义测试用例"></a> 二、在Syzkaller中添加规则（自定义测试用例）</h1>
<p>在syzkaller/sys/linux目录添加新的文件operate.txt</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">include &lt;linux/fs.h&gt;</span><br><span class="line"></span><br><span class="line">open<span class="variable">$proc</span>(file ptr[<span class="keyword">in</span>, string[<span class="string">&quot;/proc/test&quot;</span>]], flags flags[proc_open_flags], mode flags[proc_open_mode]) fd</span><br><span class="line"><span class="built_in">read</span><span class="variable">$proc</span>(fd fd, buf buffer[out], count len[buf])</span><br><span class="line">write<span class="variable">$proc</span>(fd fd, buf buffer[<span class="keyword">in</span>], count len[buf])</span><br><span class="line">close<span class="variable">$proc</span>(fd fd)</span><br><span class="line"></span><br><span class="line">proc_open_flags = O_RDONLY, O_WRONLY, O_RDWR, O_APPEND, FASYNC, O_CLOEXEC, O_CREAT, O_DIRECT, O_DIRECTORY, O_EXCL, O_LARGEFILE, O_NOATIME, O_NOCTTY, O_NOFOLLOW, O_NONBLOCK, O_PATH, O_SYNC, O_TRUNC, __O_TMPFILE</span><br><span class="line">proc_open_mode = S_IRUSR, S_IWUSR, S_IXUSR, S_IRGRP, S_IWGRP, S_IXGRP, S_IROTH, S_IWOTH, S_IXOTH</span><br></pre></td></tr></table></figure>
<p>txt文件会被syz-extract转化成.const文件，并保存在与txt的相同目录下</p>
<p>语法如下：</p>
<ul>
<li>SyscallName$Type：SyscallName’$'‘位于符号之前，是系统调用的名称，即内核提供的接口。Type位于’$'符号之后，是系统调用的具体类型。在上面的例子中，open$proc代表着系统调用“open()”具有一个限制类型“proc”，名称由编写者确定，具体限制由后续参数确定</li>
<li>ArgumentName ArgumentType[Limit]：ArgumentName是参数的名称，而ArgumentType是其类型。在上面的例子中参数有几种类型，比如string、flags等。[Limit]将限制参数的值，如果没有具体指定，syzkaller将生成一个随机值。其中proc_open_flags和proc_open_mode都是限制的范围</li>
<li>返回值类型在最后，比如open$proc的返回值类型为fd</li>
</ul>
<p><strong>范例：</strong></p>
<ul>
<li>/dev/random字符设备
<ul>
<li>random源码路径：linux/drivers/char/random.c</li>
<li>random描述文件：<a target="_blank" rel="noopener" href="https://github.com/google/syzkaller/blob/master/sys/linux/dev_random.txt">https://github.com/google/syzkaller/blob/master/sys/linux/dev_random.txt</a></li>
</ul>
</li>
</ul>
<p><strong>使新规则生效</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> syzkaller</span><br><span class="line">make clean</span><br><span class="line">make bin/syz-extract</span><br><span class="line">./bin/syz-extract -os linux -<span class="built_in">arch</span> arm64 -sourcedir &lt;kernel_path&gt; sys/linux/operate.txt</span><br><span class="line">make generate</span><br><span class="line">make TARGETOS=linux TARGETARCH=arm64./out/target/product/aurora/prebuilt_kernel</span><br></pre></td></tr></table></figure>
<h1 id="三-环境搭建"><a class="markdownIt-Anchor" href="#三-环境搭建"></a> 三、环境搭建</h1>
<ul>
<li>配置go环境(需要go版本在1.20及以上)</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://dl.google.com/go/go1.21.4.linux-amd64.tar.gz</span><br><span class="line">tar -xf go1.21.4.linux-amd64.tar.gz</span><br><span class="line"><span class="comment"># 配置环境变量</span></span><br><span class="line">vi ~/.bashrc</span><br><span class="line"><span class="comment"># 在~/.bashrc中加入以下两行</span></span><br><span class="line"><span class="built_in">export</span> GOROOT=`<span class="built_in">pwd</span>`/go</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$GOROOT</span>/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>
<ul>
<li>下载安装syzkaller</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/google/syzkaller</span><br><span class="line"><span class="built_in">cd</span> syzkaller</span><br><span class="line">make TARGETOS=linux TARGETARCH=arm64</span><br><span class="line"><span class="comment"># 如果报aarch64-linux-gnu-gcc is missing (exec: &quot;aarch64-linux-gnu-gcc&quot;: executable file not found in ATH)</span></span><br><span class="line"><span class="comment"># 执行以下命令</span></span><br><span class="line"><span class="built_in">sudo</span> apt install gcc-aarch64-linux-gnu</span><br><span class="line"><span class="comment"># 如果报aarch64-linux-gnu-gcc: error trying to exec &#x27;cc1plus&#x27;: execvp: No such file or directory </span></span><br><span class="line"><span class="comment"># 执行以下命令</span></span><br><span class="line"><span class="built_in">sudo</span> apt install g++-aarch64-linux-gnu</span><br></pre></td></tr></table></figure>
<p>可以在syzkaller/bin目录中得到以下二进制文件</p>
<p><img src="/img/loading.gif" data-original="http://qjl988-tuchuang.oss-cn-beijing.aliyuncs.com/img/c1e627e6-a543-45fc-be49-8a7a564ed0fb.png" alt="" /></p>
<h1 id="四-测试demo"><a class="markdownIt-Anchor" href="#四-测试demo"></a> 四、测试demo</h1>
<p>其中syzkaller config配置如下：</p>
<p><img src="/img/loading.gif" data-original="http://qjl988-tuchuang.oss-cn-beijing.aliyuncs.com/img/b5182ada-188f-48b8-8cad-e5e34c26c37b.png" alt="b5182ada-188f-48b8-8cad-e5e34c26c37b" /></p>
<ul>
<li><strong>http</strong>为syzkaller统计结果的前端展示界面ip:port</li>
<li><strong>devices</strong>对应的值为adb devices对应的设备ID，可以指定多个</li>
<li><strong>kernel_obj</strong>对应下载好的vmlinux路径</li>
<li><strong>enable_syscalls</strong>为mount 代表只测试mount（也可以用disable_syscalls表示不测某些syscall）</li>
<li><strong>disable_syscalls</strong>表示禁用某些syscall</li>
</ul>
<p>具体参数信息见<a target="_blank" rel="noopener" href="https://github.com/google/syzkaller/blob/master/pkg/mgrconfig/config.go">https://github.com/google/syzkaller/blob/master/pkg/mgrconfig/config.go</a></p>
<p>执行syz-manager</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./bin/syz-manager --config=android.cfg</span><br></pre></td></tr></table></figure>
<p>会将sys-fuzzer和syz-executor push到Android机器中，并在Andorid环境下执行sys-fuzzer</p>
<p><img src="/img/loading.gif" data-original="http://qjl988-tuchuang.oss-cn-beijing.aliyuncs.com/img/b5182ada-188f-48b8-8cad-e5e34c26c37b.png" alt="b5182ada-188f-48b8-8cad-e5e34c26c37b" /></p>
<p><img src="/img/loading.gif" data-original="http://qjl988-tuchuang.oss-cn-beijing.aliyuncs.com/img/asynccode" alt="img" /></p>
<p>其他flag：</p>
<ul>
<li>–debug 打印所有debug信息，开启此选项时只会运行一个VM实例</li>
</ul>
<p>首先会显示哪些syscall无法使能，比如mount<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>9</mn><msub><mi>p</mi><mi>t</mi></msub><mi>c</mi><mi>p</mi><mtext>，显示</mtext><mi mathvariant="normal">‘</mi><mi mathvariant="normal">/</mi><mi>p</mi><mi>r</mi><mi>o</mi><mi>c</mi><mi mathvariant="normal">/</mi><mi>f</mi><mi>i</mi><mi>l</mi><mi>e</mi><mi>s</mi><mi>y</mi><mi>s</mi><mi>t</mi><mi>e</mi><mi>m</mi><mi>s</mi><mi>d</mi><mi>o</mi><mi>e</mi><mi>s</mi><mi>n</mi><mi>o</mi><mi>t</mi><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mn>9</mn><mi>p</mi><mi mathvariant="normal">‘</mi><mo separator="true">,</mo><mtext>表示当前内核不支持</mtext><mn>9</mn><mi>p</mi><mtext>文件系统；另外还有可能需要其他前置条件，比如要先开启某些系统调用后，才可以使用，比如下图中的</mtext><mi>m</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">9p_tcp，显示`/proc/filesystems does not contain 9p`,表示当前内核不支持9p文件系统；另外还有可能需要其他前置条件，比如要先开启某些系统调用后，才可以使用，比如下图中的mount</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">9</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">c</span><span class="mord mathnormal">p</span><span class="mord cjk_fallback">，</span><span class="mord cjk_fallback">显</span><span class="mord cjk_fallback">示</span><span class="mord">‘</span><span class="mord">/</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">o</span><span class="mord mathnormal">c</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mord mathnormal">s</span><span class="mord mathnormal">d</span><span class="mord mathnormal">o</span><span class="mord mathnormal">e</span><span class="mord mathnormal">s</span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mord mathnormal">c</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mord">9</span><span class="mord mathnormal">p</span><span class="mord">‘</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord cjk_fallback">表</span><span class="mord cjk_fallback">示</span><span class="mord cjk_fallback">当</span><span class="mord cjk_fallback">前</span><span class="mord cjk_fallback">内</span><span class="mord cjk_fallback">核</span><span class="mord cjk_fallback">不</span><span class="mord cjk_fallback">支</span><span class="mord cjk_fallback">持</span><span class="mord">9</span><span class="mord mathnormal">p</span><span class="mord cjk_fallback">文</span><span class="mord cjk_fallback">件</span><span class="mord cjk_fallback">系</span><span class="mord cjk_fallback">统</span><span class="mord cjk_fallback">；</span><span class="mord cjk_fallback">另</span><span class="mord cjk_fallback">外</span><span class="mord cjk_fallback">还</span><span class="mord cjk_fallback">有</span><span class="mord cjk_fallback">可</span><span class="mord cjk_fallback">能</span><span class="mord cjk_fallback">需</span><span class="mord cjk_fallback">要</span><span class="mord cjk_fallback">其</span><span class="mord cjk_fallback">他</span><span class="mord cjk_fallback">前</span><span class="mord cjk_fallback">置</span><span class="mord cjk_fallback">条</span><span class="mord cjk_fallback">件</span><span class="mord cjk_fallback">，</span><span class="mord cjk_fallback">比</span><span class="mord cjk_fallback">如</span><span class="mord cjk_fallback">要</span><span class="mord cjk_fallback">先</span><span class="mord cjk_fallback">开</span><span class="mord cjk_fallback">启</span><span class="mord cjk_fallback">某</span><span class="mord cjk_fallback">些</span><span class="mord cjk_fallback">系</span><span class="mord cjk_fallback">统</span><span class="mord cjk_fallback">调</span><span class="mord cjk_fallback">用</span><span class="mord cjk_fallback">后</span><span class="mord cjk_fallback">，</span><span class="mord cjk_fallback">才</span><span class="mord cjk_fallback">可</span><span class="mord cjk_fallback">以</span><span class="mord cjk_fallback">使</span><span class="mord cjk_fallback">用</span><span class="mord cjk_fallback">，</span><span class="mord cjk_fallback">比</span><span class="mord cjk_fallback">如</span><span class="mord cjk_fallback">下</span><span class="mord cjk_fallback">图</span><span class="mord cjk_fallback">中</span><span class="mord cjk_fallback">的</span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span></span></span></span>tmpfs，需要先使能fstat、geteuid、getresuid…等syscall之后才能使能</p>
<p><img src="/img/loading.gif" data-original="http://qjl988-tuchuang.oss-cn-beijing.aliyuncs.com/img/asynccode" alt="img" /></p>
<p>之后会显示具体的信息：</p>
<p><img src="/img/loading.gif" data-original="http://qjl988-tuchuang.oss-cn-beijing.aliyuncs.com/img/5c763695-ba27-455d-9996-6e628899a49c.png" alt="5c763695-ba27-455d-9996-6e628899a49c" /></p>
<p>打开浏览器查看测试结果</p>
<p>ip为config中的http,即为android.cfg中的&quot;http&quot;:“127.0.0.1:56741” （默认值，可配置）</p>
<p>在浏览器中输入<a target="_blank" rel="noopener" href="http://127.0.0.1:56741/">http://127.0.0.1:56741/</a></p>
<p><img src="/img/loading.gif" data-original="http://qjl988-tuchuang.oss-cn-beijing.aliyuncs.com/img/asynccode" alt="img" /></p>
<p>其中选中的syscall数量为2，input数量为1，即每个syscall有一个测试序列</p>
<p><img src="/img/loading.gif" data-original="http://qjl988-tuchuang.oss-cn-beijing.aliyuncs.com/img/asynccode" alt="img" /></p>
<p>coverage信息</p>
<p><img src="/img/loading.gif" data-original="http://qjl988-tuchuang.oss-cn-beijing.aliyuncs.com/img/asynccode" alt="img" /></p>
<p>crash信息会存放在<code>$work_dir/crashed</code>中</p>
<p>在config文件中删除enable_syscalls（使能所有syscall用例），重新测试。</p>
<p><img src="/img/loading.gif" data-original="http://qjl988-tuchuang.oss-cn-beijing.aliyuncs.com/img/asynccode" alt="img" /></p>
<p>每个syscall占一行：</p>
<p><img src="/img/loading.gif" data-original="http://qjl988-tuchuang.oss-cn-beijing.aliyuncs.com/img/asynccode" alt="img" /></p>
<p>Corpus表现当前语料库中保存的有效用例</p>
<p><img src="/img/loading.gif" data-original="http://qjl988-tuchuang.oss-cn-beijing.aliyuncs.com/img/asynccode" alt="img" /></p>
<p><img src="/img/loading.gif" data-original="http://qjl988-tuchuang.oss-cn-beijing.aliyuncs.com/img/asynccode" alt="img" /></p>
<p>查看生成的测试用例syscall序列</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">openat$binderfs的测试用例</span><br><span class="line">r0 = openat$binderfs(0xffffffffffffff9c, &amp;(0x7f00000000c0)=&#x27;./binderfs/binder0\x00&#x27;, 0x0, 0x0)</span><br><span class="line">ioctl$BINDER_SET_CONTEXT_MGR_EXT(r0, 0x4018620d, &amp;(0x7f0000000080)=&#123;0x73622a85, 0x100&#125;)</span><br><span class="line">mmap$binder(&amp;(0x7f00000a0000)=nil, 0x2000, 0x1, 0x11, r0, 0x0)</span><br><span class="line">r1 = openat$binderfs(0xffffffffffffff9c, &amp;(0x7f00000000c0)=&#x27;./binderfs/binder1\x00&#x27;, 0x0, 0x0)</span><br><span class="line">mmap$binder(&amp;(0x7f00000c0000)=nil, 0x2000, 0x1, 0x11, r1, 0x0)</span><br><span class="line">ioctl$BINDER_WRITE_READ(r1, 0xc0306201, &amp;(0x7f0000000100)=&#123;0x4c, 0x0, &amp;(0x7f0000000140)=[@transaction_sg=&#123;0x40486311, &#123;0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x58, 0x18, &amp;(0x7f00000001c0)=&#123;@flat, @fd=&#123;0x66642a85, 0x0, r0&#125;, @ptr=&#123;0x70742a85, 0x0, &amp;(0x7f0000000240)=&quot;&quot;/10, 0xa&#125;&#125;, &amp;(0x7f0000000280)=&#123;0x0, 0x18, 0x30&#125;&#125;, 0x10&#125;], 0x0, 0x0, &amp;(0x7f00000002c0)&#125;)</span><br><span class="line"></span><br><span class="line">openat$urandom的测试用例</span><br><span class="line">mmap(&amp;(0x7f0000000000/0x2000)=nil, 0x2000, 0x3, 0x32, 0xffffffffffffffff, 0x0)</span><br><span class="line">r0 = openat$urandom(0xffffffffffffff9c, &amp;(0x7f0000000040), 0x0, 0x0)</span><br><span class="line">read(r0, &amp;(0x7f0000000000), 0x2000)</span><br><span class="line">close(r0)</span><br><span class="line">r1 = openat(0xffffffffffffff9c, &amp;(0x7f0000000080)=&#x27;./file1\x00&#x27;, 0x105042, 0x1ff)</span><br><span class="line">read(r1, &amp;(0x7f0000000000), 0x2000)</span><br><span class="line">close(r1)</span><br><span class="line">munmap(&amp;(0x7f0000000000/0x2000)=nil, 0x2000)</span><br><span class="line"></span><br><span class="line">socket$inet_udp的测试用例</span><br><span class="line">r0 = socket$inet_udp(0x2, 0x2, 0x0)</span><br><span class="line">bind$inet(r0, &amp;(0x7f0000000040)=&#123;0x2, 0x4e20, @empty&#125;, 0x10)</span><br><span class="line">r1 = socket$inet_udp(0x2, 0x2, 0x0)</span><br><span class="line">sendto$inet(r1, &amp;(0x7f0000000080)=&#x27;\x00&#x27;/10, 0xa, 0x0, &amp;(0x7f00000000c0)=&#123;0x2, 0x4e20, @empty&#125;, 0x10)</span><br><span class="line">recvfrom(r0, &amp;(0x7f0000000100)=&quot;&quot;/10, 0xa, 0x0, 0x0, 0x0)</span><br><span class="line"></span><br><span class="line">close的测试用例</span><br><span class="line"></span><br><span class="line">r0 = socket$inet_icmp(0x2, 0x2, 0x1)</span><br><span class="line">close(r0)</span><br></pre></td></tr></table></figure>
<p>由上面的结果可以得到结论，对于待测的syscall，syzkaller会根据函数调用规则（比如根据返回值、参数类型）构建有上下关联的syscall序列</p>
<p><strong>总结</strong></p>
<ol>
<li>Kernel开启KCOV和KASAN的必要性</li>
</ol>
<p><code>KCOV</code>用于收集内核代码执行时的覆盖率信息。syzkaller基于代码覆盖率进行用例生成，主要体现在以下两方面：</p>
<ul>
<li>执行每次生成的用例，如果覆盖率发生变化，则证明该用例是有效的,会记录在语料库中</li>
<li>覆盖率可以进一步引导syzkaller生成新的用例</li>
</ul>
<p>开启<code>KASan</code>能显著提高模糊测试发现内存相关错误的能力，从而捕捉到那些可能导致系统崩溃、数据损坏或安全漏洞的内存操作错误。KASan如果不开启，就只能等到内核panic才能知道出现了问题，发现问题的范围就会减小，同时分析难度大大增加。</p>
<ol>
<li>系统调用的覆盖以及用例集的随机性</li>
</ol>
<p>在配置文件中可以指定要测试的syscall，对于指定的syscall，syzkaller产生的用例集取决于syscall对应的描述语言，如果某个syscall的参数不依赖于其他的syscall返回值，那么产生的测试用例syscall序列和参数都是随机；如果当前syscall的参数依赖于其他的syscall返回值（比如read依赖于open），那么syzkaller会按照依赖顺序产生测试用例（参数随机）（假如A依赖于B的返回值，那么在生成的序列中A一定在B后面，中间可能会有其他syscall）</p>
<p>如果没有指定syscall（即使能所有syscall），syzkaller首先会判断当前系统支持的syscall，之后针对每个syscall的处理方式同上。</p>
<ol>
<li>syzkaller的使用需要对kernel的编译和系统调用有一定了解
<ol>
<li>使用<code>syzkaller</code>，推荐的内核配置参数不仅仅只有KCOV和KASan，其余flag见<strong>附录</strong>。需要对每个配置参数有一定的了解</li>
<li>编写syzlang需要对系统调用接口和kernel源码有一定的了解</li>
</ol>
</li>
</ol>
<h1 id="五-测试流程"><a class="markdownIt-Anchor" href="#五-测试流程"></a> 五、测试流程</h1>
<ol>
<li>找kernel的研发同学打一个带有KCOV和KASAN的包（userroot或userdebug），vendor侧需要勾选Symbols</li>
<li>按照“三、环境搭建”中的流程安装go和syzkaller</li>
<li>准备3-4台机器（电量需要在30%以上），刷1中打好的包，并下载vmlinux（见第四节的2）</li>
<li>在syzkaller目录下添加配置文件android.cfg，具体内容如下：</li>
</ol>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        <span class="string">&quot;target&quot;</span>: <span class="string">&quot;linux/arm64&quot;</span>,   <span class="comment">// 不用改</span></span><br><span class="line">        <span class="string">&quot;http&quot;</span>: <span class="string">&quot;127.0.0.1:56741&quot;</span>,  <span class="comment">// 可以改成局域网ip，这样在整个局域网的所有用户都可以看见</span></span><br><span class="line">                                    <span class="comment">// 即ifconfig命令下 10.xx.xx.xx对应的ip地址</span></span><br><span class="line">        <span class="string">&quot;workdir&quot;</span>: <span class="string">&quot;workdir&quot;</span>, <span class="comment">// 指定crash信息的存储路径，不用改</span></span><br><span class="line">        <span class="string">&quot;kernel_obj&quot;</span>: <span class="string">&quot;./prebuilt_kernel&quot;</span>, <span class="comment">// vmlinux、源码等存储目录</span></span><br><span class="line">        <span class="string">&quot;syzkaller&quot;</span>: <span class="string">&quot;./&quot;</span>, <span class="comment">// 不用改</span></span><br><span class="line">        <span class="string">&quot;cover&quot;</span>: <span class="literal">true</span>, <span class="comment">// 不用改</span></span><br><span class="line">        <span class="string">&quot;reproduce&quot;</span>: <span class="literal">false</span>, <span class="comment">// 当出现crash时，是否需要复现，如果为了发现是否有bug，可以置为false</span></span><br><span class="line">                            <span class="comment">// 置为true的话，当发现crash时，后续多数机器会用于复现该crash</span></span><br><span class="line">                            <span class="comment">// 会减缓测试效率</span></span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;adb&quot;</span>,  <span class="comment">// 不用改</span></span><br><span class="line">        <span class="string">&quot;vm&quot;</span>: &#123;  </span><br><span class="line">                <span class="string">&quot;devices&quot;</span>: [<span class="string">&quot;5e366360&quot;</span>,<span class="string">&quot;6ad55d2d&quot;</span>,<span class="string">&quot;ea3105ab&quot;</span>], <span class="comment">// adb devices命令对应的序列号</span></span><br><span class="line">                                                               <span class="comment">// 每台机器对应一个</span></span><br><span class="line">                <span class="string">&quot;battery_check&quot;</span>: <span class="literal">true</span>  <span class="comment">// 不用改</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在syzkaller目录下创建prebuilt_kernel目录（如果没有的话），之后将3中下载好的vmlinux放到prebuilt_kernel目录下（如果需要在前端页面查看coverage信息，还需要将kernel源码放到该目录下）</li>
<li>进入到syzkaller目录下，执行 <code>./bin/syz-manager --config=android.cfg</code>命令，之后在浏览器中输入android.cfg文件中http对应的信息即可查看结果</li>
</ol>
<p><strong>总结</strong></p>
<p>由于syzkaller是无监督的用覆盖率做引导的内核模糊测试工具，在产生测试用例时会随机构造函数参数和调用序列，每次测试的结果（比如产生的测试用例、代码覆盖情况）可能会不同。</p>
<p>在测试过程中，测试的前期产生的有效测试用例个数(即页面中的corpus)增长很快，同时代码的覆盖情况也是增长很快。随着测试的进行，有效测试用例个数和代码覆盖情况变化情况会趋于平缓（此时是因为syzkaller随机产生的测试用例并不会产生新的覆盖，也就不会判定为是一个有效的用例）</p>
<p>syzkaller每测试一组系统调用case后，就会重启手机。</p>
<p>目前暂定一轮的测试时间是24h，测试机器台数为4台，后续需要根据具体的测试结果再进行调整。</p>
<h1 id="六-相关问题"><a class="markdownIt-Anchor" href="#六-相关问题"></a> 六、相关问题</h1>
<p><img src="/img/loading.gif" data-original="http://qjl988-tuchuang.oss-cn-beijing.aliyuncs.com/img/asynccode" alt="img" /></p>
<h1 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h1>
<ul>
<li>Android环境测试搭建 <a target="_blank" rel="noopener" href="https://github.com/google/syzkaller/blob/master/docs/linux/setup_linux-host_android-device_arm-kernel.md">https://github.com/google/syzkaller/blob/master/docs/linux/setup_linux-host_android-device_arm-kernel.md</a></li>
<li>Kernel flag配置<a target="_blank" rel="noopener" href="https://github.com/xairy/syzkaller/blob/master/docs/linux/kernel_configs.md">syzkaller/docs/linux/kernel_configs.md at master · xairy/syzkaller</a></li>
<li>android.cfg（–config指定的配置文件）说明：
<ul>
<li>例子：<a target="_blank" rel="noopener" href="https://github.com/google/syzkaller/blob/master/pkg/mgrconfig/testdata/qemu.cfg">syzkaller/pkg/mgrconfig/testdata/qemu.cfg at master · google/syzkaller</a></li>
<li>参数说明：<a target="_blank" rel="noopener" href="https://github.com/google/syzkaller/blob/master/pkg/mgrconfig/config.go">https://github.com/google/syzkaller/blob/master/pkg/mgrconfig/config.go</a></li>
</ul>
</li>
<li>syzkaller coverage：<a target="_blank" rel="noopener" href="https://github.com/google/syzkaller/blob/master/docs/coverage.md">syzkaller/docs/coverage.md at master · google/syzkaller</a></li>
<li>syzkaller Syscall descriptions：<a target="_blank" rel="noopener" href="https://github.com/google/syzkaller/blob/master/docs/syscall_descriptions.md">https://github.com/google/syzkaller/blob/master/docs/syscall_descriptions.md</a></li>
<li>测试x86系统调用bug <a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_46161993/article/details/113869350">https://blog.csdn.net/m0_46161993/article/details/113869350</a></li>
</ul>
<h1 id="附录"><a class="markdownIt-Anchor" href="#附录"></a> 附录</h1>
<ol>
<li>
<h2 id="kernel相关编译参数"><a class="markdownIt-Anchor" href="#kernel相关编译参数"></a> kernel相关编译参数</h2>
</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://github.com/google/syzkaller/blob/master/docs/linux/kernel_configs.md">syzkaller/docs/linux/kernel_configs.md at master · google/syzkaller</a></p>
<p><strong>Coverage</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CONFIG_KCOV=y</span><br><span class="line"></span><br><span class="line">CONFIG_KCOV_INSTRUMENT_ALL=y </span><br><span class="line">CONFIG_KCOV_ENABLE_COMPARISONS=y</span><br><span class="line">CONFIG_DEBUG_FS=y</span><br><span class="line"></span><br><span class="line">CONFIG_DEBUG_INFO=y</span><br></pre></td></tr></table></figure>
<p><strong>MemLeak</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CONFIG_DEBUG_KMEMLEAK=y</span><br></pre></td></tr></table></figure>
<p><strong>Sandbox</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CONFIG_NAMESPACES=y</span><br><span class="line">CONFIG_UTS_NS=y</span><br><span class="line">CONFIG_IPC_NS=y</span><br><span class="line">CONFIG_PID_NS=y</span><br><span class="line">CONFIG_NET_NS=y</span><br><span class="line">CONFIG_CGROUP_PIDS=y</span><br><span class="line">CONFIG_MEMCG=y</span><br><span class="line">CONFIG_USER_NS=y</span><br></pre></td></tr></table></figure>
<p><strong>KASAN</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CONFIG_KASAN=y</span><br><span class="line">CONFIG_KASAN_INLINE=y</span><br></pre></td></tr></table></figure>
<p><strong>Fault Injection</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CONFIG_FAULT_INJECTION=y</span><br><span class="line">CONFIG_FAULT_INJECTION_DEBUG_FS=y</span><br><span class="line">CONFIG_FAULT_INJECTION_USERCOPY=y</span><br><span class="line">CONFIG_FAILSLAB=y</span><br><span class="line">CONFIG_FAIL_PAGE_ALLOC=y</span><br><span class="line">CONFIG_FAIL_MAKE_REQUEST=y</span><br><span class="line">CONFIG_FAIL_IO_TIMEOUT=y</span><br><span class="line">CONFIG_FAIL_FUTEX=y</span><br></pre></td></tr></table></figure>
<p><strong>Timeout</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CONFIG_DEFAULT_HUNG_TASK_TIMEOUT=140</span><br><span class="line">CONFIG_RCU_CPU_STALL_TIMEOUT=100</span><br></pre></td></tr></table></figure>
<p><strong>Others</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CONFIG_LOCKDEP=y</span><br><span class="line">CONFIG_PROVE_LOCKING=y</span><br><span class="line">CONFIG_DEBUG_ATOMIC_SLEEP=y</span><br><span class="line">CONFIG_PROVE_RCU=y</span><br><span class="line">CONFIG_DEBUG_VM=y</span><br><span class="line">CONFIG_REFCOUNT_FULL=y</span><br><span class="line">CONFIG_FORTIFY_SOURCE=y</span><br><span class="line">CONFIG_HARDENED_USERCOPY=y</span><br><span class="line">CONFIG_LOCKUP_DETECTOR=y</span><br><span class="line">CONFIG_SOFTLOCKUP_DETECTOR=y</span><br><span class="line">CONFIG_HARDLOCKUP_DETECTOR=y</span><br><span class="line">CONFIG_BOOTPARAM_HARDLOCKUP_PANIC=y</span><br><span class="line">CONFIG_DETECT_HUNG_TASK=y</span><br><span class="line">CONFIG_WQ_WATCHDOG=y</span><br></pre></td></tr></table></figure>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/fuzz/">fuzz</a></div><div class="post-share"><div class="social-share" data-image="/img/butterfly-icon.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2024/12/17/%E5%AD%A6%E4%B9%A0/linux/2024-12-17shell/" title="shell&amp;bash"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">shell&bash</div></div><div class="info-2"><div class="info-item-1"> 第一部分 bash简介 在介绍bash之前，需要先了解它的起源——shell。 shell俗称壳，它是指UNIX系统下的一个命令解析器；主要用于用户和系统的交互。 UNIX系统上有很多种Shell。首个shell，即Bourne Shell，于1978年在V7(AT&amp;T的第7版)UNIX上推出。后来，又演变出C shell、bash等不同版本的shell。 bash，全称为Bourne-Again Shell。它是一个为GNU项目编写的Unix shell。bash脚本功能非常强大，尤其是在处理自动循环或大的任务方面可节省大量的时间。bash是许多Linux平台的内定Shell，这也是我们介绍它主要的原因。  第二部分 bash基础  变量使用 1 基础 命令：变量=值。 等号两边不能有空格！如果值有空格，需要用&quot;&quot;或''引用起来。 # !/bin/basha = 10b = &quot;10&quot;readonly c = 3 # 只读变量，不能被修改 2 引用变量 命令：$变量名。 以下三种引用变量的方式等价。 # !/bin/basha...</div></div></div></a><a class="pagination-related" href="/2024/12/08/hello-world/" title="Hello World"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Hello World</div></div><div class="info-2"><div class="info-item-1">Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.  Quick Start  Create a new post $ hexo new &quot;My New Post&quot; More info: Writing  Run server $ hexo server More info: Server  Generate static files $ hexo generate More info: Generating  Deploy to remote sites $ hexo deploy More info: Deployment </div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/loading.gif" data-original="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">qjl988</div><div class="author-info-description">钱家黎的博客</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">3</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/qjl988"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/qjl988" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://blog.csdn.net/mjh1667002013" target="_blank" title="CSDN"><i class="fa fa-book-open"></i></a><a class="social-icon" href="tencent://AddContact/?fromId=45&amp;fromSubId=1&amp;subcmd=all&amp;uin=728831102&amp;website=www.oicqzone.com" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="mailto:1976083684@qq.com" target="_blank" title="Email"><i class="fas fa-email"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80-syzkaller%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-text"> 一、Syzkaller工作原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E7%AE%80%E4%BB%8B"><span class="toc-text"> 1.1 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-syscall-%E6%8F%8F%E8%BF%B0%E8%AF%AD%E8%A8%80syzlang"><span class="toc-text"> 1.2. syscall 描述语言（syzlang）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-crash"><span class="toc-text"> 1.3. crash</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C-%E5%9C%A8syzkaller%E4%B8%AD%E6%B7%BB%E5%8A%A0%E8%A7%84%E5%88%99%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B"><span class="toc-text"> 二、在Syzkaller中添加规则（自定义测试用例）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-text"> 三、环境搭建</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B-%E6%B5%8B%E8%AF%95demo"><span class="toc-text"> 四、测试demo</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94-%E6%B5%8B%E8%AF%95%E6%B5%81%E7%A8%8B"><span class="toc-text"> 五、测试流程</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD-%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98"><span class="toc-text"> 六、相关问题</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-text"> 参考</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%99%84%E5%BD%95"><span class="toc-text"> 附录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#kernel%E7%9B%B8%E5%85%B3%E7%BC%96%E8%AF%91%E5%8F%82%E6%95%B0"><span class="toc-text"> kernel相关编译参数</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/17/%E5%AD%A6%E4%B9%A0/linux/2024-12-17shell/" title="shell&amp;bash">shell&amp;bash</a><time datetime="2024-12-17T14:43:26.000Z" title="发表于 2024-12-17 22:43:26">2024-12-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/11/%E5%B0%8F%E7%B1%B3/syzkaller/syzkaller01-%E9%85%8D%E7%BD%AE/" title="syzkaller01-配置">syzkaller01-配置</a><time datetime="2024-12-10T17:10:45.000Z" title="发表于 2024-12-11 01:10:45">2024-12-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/08/hello-world/" title="Hello World">Hello World</a><time datetime="2024-12-07T19:18:25.281Z" title="发表于 2024-12-08 03:18:25">2024-12-08</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2024 By qjl988</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(async () => {
  const showKatex = () => {
    document.querySelectorAll('#article-container .katex').forEach(el => el.classList.add('katex-show'))
  }

  if (!window.katex_js_css) {
    window.katex_js_css = true
    await btf.getCSS('https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css')
    if (true) {
      await btf.getScript('https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js')
    }
  }

  showKatex()
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z\d\-\.\+]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(t.test(e.href)||r.test(e.href))&&(e.href=a.dataset.original)})});</script><script>(r=>{r.imageLazyLoadSetting.processImages=t;var a=r.imageLazyLoadSetting.isSPA,o=r.imageLazyLoadSetting.preloadRatio||1,d=i();function i(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(t){(a||t)&&(d=i());for(var e,n=0;n<d.length;n++)0<=(e=(e=d[n]).getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(r.innerHeight*o||document.documentElement.clientHeight*o)&&(()=>{var t,e,a,o,i=d[n];e=function(){d=d.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).dataset.loaded||(t.hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(a=new Image,o=t.getAttribute("data-original"),a.onload=function(){t.src=o,t.removeAttribute("data-original"),t.setAttribute("data-loaded",!0),e&&e()},a.onerror=function(){t.removeAttribute("data-original"),t.setAttribute("data-loaded",!1),t.src=o},t.src!==o&&(a.src=o)))})()}function e(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",e),r.addEventListener("resize",e),r.addEventListener("orientationchange",e)})(this);</script></body></html>